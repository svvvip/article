import{r as C,j as e,B as x,k as T}from"./index-B01K6LtN.js";import{H as _,S as F,T as z,C as D}from"./theme-switch-Cj3HdUhw.js";import{I as k,M as q}from"./image-mode-switch-r2FRk6wG.js";import{u as L,f as H,F as I,a as h,b as p,d as j}from"./form-CxRSSxqG.js";import{u}from"./useQuery-DrhposrY.js";import{f as V}from"./config-DY6TxoJ-.js";import{r as B}from"./request-2_miQ1pQ.js";import{S as g,a as f,b as w,c as v,d as N,T as M,e as E,f as t,g as l,h as K,i as r}from"./table-Cszo8gXU.js";import{C as P}from"./pagination-CpkMZhyM.js";import{x as R}from"./dropdown-menu-C5nmmplu.js";import"./index-WrHNe2I8.js";import"./index-BWB9MiGf.js";import"./index-CWOWhum8.js";import"./index-Dx9d1UQ8.js";import"./createLucideIcon-CCBfe0vc.js";import"./separator-6OHr6uP3.js";import"./index-C2uM0dkt.js";import"./check-BMIXQX84.js";import"./eye-Bvpb1x--.js";import"./index-BdQq_4o_.js";import"./index-BaKbMfrS.js";import"./newspaper-DWNG5Kd-.js";import"./scroll-area-QD9Lh6Qq.js";import"./arrow-right-DSH9sgvw.js";function Q(o){return B({url:"/download-log/search",method:"post",data:o})}function W(){const o=L({defaultValues:{downloader:"",save_path:""}}),[n,i]=C.useState({downloader:"",save_path:"",page:1,page_size:20}),{data:d,isLoading:b}=u({queryKey:["download-log",n],queryFn:async()=>(await Q(n)).data,staleTime:300*1e3}),{data:c}=u({queryKey:["downloaders"],queryFn:async()=>(await V()).data,staleTime:300*1e3}),m=H({control:o.control,name:"downloader"}),S=c?.find(s=>s.id===m)?.save_paths??[],y=s=>{i(a=>({...a,downloader:s.downloader,save_path:s.save_path}))};return e.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[e.jsx("div",{className:"sticky top-0 z-10 mb-2",children:e.jsx(I,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(y),className:"grid grid-cols-2 lg:grid-cols-4 items-end gap-4",children:[e.jsx(h,{control:o.control,name:"downloader",render:({field:s})=>e.jsx(p,{children:e.jsxs(g,{value:s.value,onValueChange:a=>{s.onChange(a)},children:[e.jsx(j,{children:e.jsx(f,{className:"w-full",children:e.jsx(w,{placeholder:"选择下载器"})})}),e.jsx(v,{className:"w-full",children:c?.map(a=>e.jsx(N,{value:a.id,children:a.id},a.id))})]})})}),e.jsx(h,{control:o.control,name:"save_path",render:({field:s})=>e.jsx(p,{className:"flex items-center gap-2",children:e.jsxs(g,{value:s.value,onValueChange:s.onChange,disabled:!m,children:[e.jsx(j,{children:e.jsx(f,{className:"w-full",children:e.jsx(w,{placeholder:"选择路径"})})}),e.jsx(v,{className:"w-full",children:S.map(a=>e.jsx(N,{value:a.path,children:a.path},a.path))})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{type:"submit",className:"w-[60px]",children:e.jsx(R,{})}),e.jsx(x,{variant:"outline",className:"w-[60px]",onClick:()=>{o.reset(),i({page:1,page_size:20,downloader:"",save_path:""})},children:"重置"})]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto rounded-lg border",children:e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs(t,{children:[e.jsx(l,{children:"tid"}),e.jsx(l,{children:"板块"}),e.jsx(l,{children:"分类"}),e.jsx(l,{children:"标题"}),e.jsx(l,{children:"大小"}),e.jsx(l,{children:"预览图"}),e.jsx(l,{children:"下载器"}),e.jsx(l,{children:"保存路径"}),e.jsx(l,{children:"下载时间"})]})}),e.jsx(K,{children:b?e.jsx(t,{children:e.jsx(r,{colSpan:9,className:"text-center",children:"加载中..."})}):d?.items.length===0?e.jsx(t,{children:e.jsx(r,{colSpan:9,className:"text-center",children:"暂无数据"})}):d?.items.map(s=>e.jsxs(t,{children:[e.jsx(r,{children:s.tid}),e.jsx(r,{children:s.section}),e.jsx(r,{children:s.category}),e.jsx(r,{className:"max-w-[260px] truncate",children:s.title}),e.jsxs(r,{children:[s.size,"mb"]}),e.jsx(r,{children:s.preview_images?e.jsx("img",{src:s.preview_images.split(",")[0],alt:"",className:"h-10 w-16 rounded object-cover"}):"-"}),e.jsx(r,{children:s.downloader}),e.jsx(r,{className:"max-w-[240px] truncate",children:s.save_path}),e.jsx(r,{children:T(s.download_time)})]},s.id))})]})}),e.jsx("div",{className:"sticky bottom-0 z-10 mt-2",children:e.jsx(P,{page:n.page,total:d?.total||0,pageSize:n.page_size,onChange:s=>i(a=>({...a,page:s}))})})]})}function $(){return e.jsxs(e.Fragment,{children:[e.jsxs(_,{fixed:!0,children:[e.jsx(F,{}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(k,{}),e.jsx(z,{}),e.jsx(D,{})]})]}),e.jsxs(q,{fixed:!0,children:[e.jsx("div",{className:"flex flex-wrap items-end justify-between gap-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"下载记录"}),e.jsx("p",{className:"text-muted-foreground",children:"查询下载记录"})]})}),e.jsx(W,{})]})]})}const ue=$;export{ue as component};
