import{r as f,h as B,o as R,j as e,B as r,c as E,t as g,i as H,s as d}from"./index-B01K6LtN.js";import{H as K,S as Q,T as A,C as D}from"./theme-switch-Cj3HdUhw.js";import{I as L,M as O}from"./image-mode-switch-r2FRk6wG.js";import{u as V,f as W,F as Z,a as l,b as c,c as i,d as o,e as b,g as k}from"./form-CxRSSxqG.js";import{a as $}from"./zod-C1KCSxpg.js";import{u as v}from"./useQuery-DrhposrY.js";import{u as _}from"./useMutation-DrK_Az29.js";import{r as G,u as J,a as U,d as X,g as Y,f as ee}from"./task-rDQu81np.js";import{B as se}from"./badge-CnpEfJTD.js";import{I as T}from"./input-c0Q4JQol.js";import{S as ae,a as te,b as ne,c as re,d as le,T as ce,e as ie,f as C,g as m,h as oe,i as x}from"./table-Cszo8gXU.js";import{T as de,S as me}from"./textarea-C9aYxd8c.js";import{R as xe}from"./response-modal-_P3EDDAe.js";import{c as S}from"./createLucideIcon-CCBfe0vc.js";import{C as ue}from"./clock-CxH_gih8.js";import{P as he,T as pe}from"./trash-2-DsQGbZ5q.js";import{P as je}from"./pencil-CKo1h-o3.js";import"./index-WrHNe2I8.js";import"./index-BWB9MiGf.js";import"./index-CWOWhum8.js";import"./index-Dx9d1UQ8.js";import"./dropdown-menu-C5nmmplu.js";import"./index-BaKbMfrS.js";import"./newspaper-DWNG5Kd-.js";import"./scroll-area-QD9Lh6Qq.js";import"./index-BdQq_4o_.js";import"./arrow-right-DSH9sgvw.js";import"./separator-6OHr6uP3.js";import"./index-C2uM0dkt.js";import"./check-BMIXQX84.js";import"./eye-Bvpb1x--.js";import"./request-2_miQ1pQ.js";const fe=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ge=S("play",fe);const be=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ne=S("zap",be),ye=R({task_name:d().min(2,"任务名称至少2个字符"),task_func:d().min(1,"请选择执行函数"),task_args:d(),task_cron:d().min(5,"请输入有效的 Cron 表达式"),enable:H()}),F={task_name:"",task_func:"",task_args:"",task_cron:"0 * * * *",enable:!0};function we(){const[t,u]=f.useState(null),[h,p]=f.useState(!1),N=B(),{data:y}=v({queryKey:["tasks"],queryFn:async()=>(await Y()).data,staleTime:300*1e3}),j=_({mutationFn:async s=>t?await J({...s,id:t.id}):await U({...s,id:0}),onSuccess:s=>{g.success(s.message),N.invalidateQueries({queryKey:["tasks"]}),p(!1),u(null)}}),M=_({mutationFn:X,onSuccess:s=>{g.success(s.message),N.invalidateQueries({queryKey:["tasks"]})}}),{data:w}=v({queryKey:["taskFunc"],queryFn:async()=>(await ee()).data,staleTime:300*1e3}),a=V({resolver:$(ye),defaultValues:F}),q=W({control:a.control,name:"task_func"}),I=w?.find(s=>s.func_name===q)?.func_args;f.useEffect(()=>{t?a.reset(t):h&&a.reset(F)},[t,h,a]);const P=async s=>{M.mutate(s)},z=async s=>{const n=await G(s);g.success(n.message)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border p-4 shadow-sm md:p-6",children:[e.jsx("div",{className:"space-y-1",children:e.jsxs("p",{className:"flex items-center gap-1 text-xs text-muted-foreground md:text-sm",children:[e.jsx(Ne,{className:"h-3 w-3 fill-amber-500 text-amber-500"}),"当前活跃任务: ",y?.filter(s=>s.enable).length]})}),e.jsx(xe,{title:t?"编辑任务":"创建新任务",open:h,onOpenChange:p,trigger:e.jsxs(r,{onClick:()=>u(null),className:"rounded-full",children:[e.jsx(he,{})," 新增任务"]}),children:e.jsx(Z,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(s=>{j.mutate(s)}),className:"space-y-4",children:[e.jsx(l,{control:a.control,name:"task_name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"任务名称"}),e.jsx(o,{children:e.jsx(T,{placeholder:"输入任务名称",...s})}),e.jsx(b,{})]})}),e.jsx(l,{control:a.control,name:"task_func",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"执行函数"}),e.jsx(o,{children:e.jsxs(ae,{onValueChange:s.onChange,value:s.value,children:[e.jsx(te,{className:"w-full",children:e.jsx(ne,{placeholder:"选择函数"})}),e.jsx(re,{className:"w-full",children:w?.map(n=>e.jsx(le,{value:n.func_name,children:n.func_label},n.func_name))})]})})]})}),e.jsx(l,{control:a.control,name:"task_args",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"函数参数"}),e.jsx(o,{children:e.jsx(de,{...s,placeholder:'{"arg_name":"arg_value"}'})}),e.jsx(k,{children:e.jsxs("span",{children:["参数列表: ",I]})})]})}),e.jsx(l,{control:a.control,name:"task_cron",render:({field:s})=>e.jsxs(c,{children:[e.jsx(i,{children:"Cron 表达式"}),e.jsx(o,{children:e.jsxs("div",{className:"relative",children:[e.jsx(T,{...s}),e.jsx(ue,{className:"absolute top-1/2 right-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"})]})}),e.jsxs(k,{children:[e.jsx("span",{className:"rounded bg-muted px-1.5 py-0.5 italic",children:"*/5 * * * * (每5分)"}),e.jsx("span",{className:"rounded bg-muted px-1.5 py-0.5 italic",children:"0 0 * * * (每日)"})]}),e.jsx(b,{})]})}),e.jsx(l,{control:a.control,name:"enable",render:({field:s})=>e.jsxs(c,{className:"flex items-center justify-between",children:[e.jsx(i,{children:"开启任务"}),e.jsx(o,{children:e.jsx(me,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(b,{})]})}),e.jsx(r,{type:"submit",disabled:j.isPending,className:"w-full",children:j.isPending?"保存中...":"保存配置"})]})})})]}),e.jsx("div",{className:"overflow-hidden rounded-2xl border shadow-sm",children:e.jsxs(ce,{children:[e.jsx(ie,{className:"hidden md:table-header-group",children:e.jsxs(C,{children:[e.jsx(m,{children:"任务名称"}),e.jsx(m,{children:"执行逻辑"}),e.jsx(m,{children:"Cron 周期"}),e.jsx(m,{className:"text-right",children:"管理"})]})}),e.jsx(oe,{children:y?.map(s=>e.jsxs(C,{className:"group flex flex-col border-b p-4 transition-colors md:table-row md:p-0",children:[e.jsx(x,{className:"p-0 pb-3 md:table-cell md:py-4",children:e.jsxs("div",{className:"flex items-center gap-3 pl-2",children:[e.jsx("div",{className:E("h-2 w-2 rounded-full",s.enable?"animate-pulse bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.4)]":"bg-slate-400 shadow-none")}),e.jsx("span",{className:"text-base font-bold md:font-semibold",children:s.task_name})]})}),e.jsxs(x,{className:"flex items-start justify-between px-0 py-2 md:table-cell md:py-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground md:hidden",children:"执行逻辑"}),e.jsxs("div",{className:"flex flex-col items-end gap-2 md:flex-row md:items-center",children:[e.jsx(se,{variant:"outline",className:"font-mono",children:s.task_func}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden text-xs text-muted-foreground md:inline",children:"→"}),e.jsx("span",{className:"max-w-[200px] truncate text-xs text-slate-600 md:max-w-none",children:s.task_args})]})]})]}),e.jsxs(x,{className:"flex items-center justify-between px-0 py-2 md:table-cell md:py-4",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground md:hidden",children:"Cron 周期"}),e.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:s.task_cron})]}),e.jsx(x,{className:"flex justify-end px-0 pt-3 md:sticky md:right-0 md:table-cell md:pt-4",children:e.jsxs("div",{className:"flex w-full justify-end gap-1 border-t pt-3 md:w-auto md:border-none md:pt-0",children:[e.jsx(r,{variant:"outline",size:"icon",className:"h-9 w-9 text-emerald-600 hover:border-emerald-200 hover:bg-emerald-50 hover:text-emerald-700 md:h-8 md:w-8 md:border-none md:bg-transparent",onClick:()=>z(s.id),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(r,{variant:"outline",size:"icon",className:"md:variant-ghost h-9 w-9 md:h-8 md:w-8",onClick:()=>{u(s),p(!0)},children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(r,{variant:"outline",size:"icon",className:"md:variant-ghost h-9 w-9 text-destructive md:h-8 md:w-8",onClick:()=>P(s.id),children:e.jsx(pe,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})}function ke(){return e.jsxs(e.Fragment,{children:[e.jsxs(K,{fixed:!0,children:[e.jsx(Q,{}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(L,{}),e.jsx(A,{}),e.jsx(D,{})]})]}),e.jsxs(O,{className:"flex flex-1 flex-col gap-4 sm:gap-6",children:[e.jsx("div",{className:"flex flex-wrap items-end justify-between gap-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"任务调度管理"}),e.jsx("p",{className:"text-muted-foreground",children:"配置并监控自动执行的定时任务"})]})}),e.jsx(we,{})]})]})}const as=ke;export{as as component};
