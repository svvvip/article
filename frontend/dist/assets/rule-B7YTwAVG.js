import{r as N,h as P,o as Q,j as e,B as x,t as b,s as c,x as E}from"./index-B01K6LtN.js";import{C as H}from"./content-section-BecwT8tS.js";import{u as z,f as k,F as B,a as i,b as d,c as h,d as m,e as O}from"./form-CxRSSxqG.js";import{a as $}from"./zod-C1KCSxpg.js";import{u as S}from"./useQuery-DrhposrY.js";import{g as W}from"./article-cPZ4_sKF.js";import{f as Z}from"./config-DY6TxoJ-.js";import{r as v}from"./request-2_miQ1pQ.js";import{A as G,g as J,a as U,b as X,c as Y,d as ee,e as se,f as ae,h as re}from"./alert-dialog-B9flnKzi.js";import{I as le}from"./input-c0Q4JQol.js";import{S as j,a as p,b as g,c as f,d as o,T as ne,e as te,f as y,g as t,h as oe,i as n}from"./table-Cszo8gXU.js";import{R as ce}from"./response-modal-_P3EDDAe.js";import{c as ie}from"./createLucideIcon-CCBfe0vc.js";import{P as de,T as he}from"./trash-2-DsQGbZ5q.js";import{P as me}from"./pencil-CKo1h-o3.js";import{R as ue}from"./route-D1IAF3J3.js";import"./card-C8S_LLSC.js";import"./index-C2uM0dkt.js";import"./index-WrHNe2I8.js";import"./index-BaKbMfrS.js";import"./index-CWOWhum8.js";import"./index-BdQq_4o_.js";import"./index-Dx9d1UQ8.js";import"./check-BMIXQX84.js";const xe=[["path",{d:"M17 3v10",key:"15fgeh"}],["path",{d:"m12.67 5.5 8.66 5",key:"1gpheq"}],["path",{d:"m12.67 10.5 8.66-5",key:"1dkfa6"}],["path",{d:"M9 17a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2z",key:"swwfx4"}]],je=ie("regex",xe);function pe(){return v({url:"/rules/"})}function ge(l){return v({url:"/rules/",method:"post",data:l})}function fe(l){return v({url:"/rules/",method:"put",data:l})}function ye(l){return v({url:`/rules/${l}`,method:"delete"})}const ve=Q({id:E(),section:c().min(1,"选择板块"),category:c().min(1,"选择类目"),regex:c(),downloader:c().min(1,"选择下载器"),save_path:c().min(1,"选择保存目录")}),L={id:0,section:"",category:"",regex:"",downloader:"",save_path:""};function we(){const[l,F]=N.useState(null),[w,u]=N.useState(!1),C=P(),r=z({resolver:$(ve),defaultValues:L}),{data:R,isLoading:I}=S({queryKey:["rules"],queryFn:async()=>(await pe()).data,staleTime:300*1e3}),{data:T}=S({queryKey:["categories"],queryFn:async()=>(await W()).data,staleTime:300*1e3}),A=k({control:r.control,name:"section"}),_=T?.find(s=>s.name==A)?.categories,{data:D}=S({queryKey:["downloaders"],queryFn:async()=>(await Z()).data,staleTime:300*1e3}),q=k({control:r.control,name:"downloader"}),K=D?.find(s=>s.id==q)?.save_paths;N.useEffect(()=>{l?r.reset(l):w&&r.reset(L)},[l,r,w]);const V=async s=>{const a=await ye(s);a.code===0&&(b.success(a.message),C.invalidateQueries({queryKey:["rules"]}))},M=async s=>{if(l){const a=await fe(s);a.code===0&&(b.success(a.message),C.invalidateQueries({queryKey:["rules"]}),u(!1))}else{const a=await ge(s);a.code===0&&(b.success(a.message),C.invalidateQueries({queryKey:["rules"]}),u(!1))}};return e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:l?"编辑规则":"创建新规则",open:w,onOpenChange:u,trigger:e.jsxs(x,{onClick:()=>F(null),className:"rounded-full",children:[e.jsx(de,{})," 新增规则"]}),children:e.jsx(B,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(M),className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"section",render:({field:s})=>e.jsxs(d,{children:[e.jsx(h,{children:"板块"}),e.jsxs(j,{onValueChange:s.onChange,value:s.value,children:[e.jsx(m,{children:e.jsx(p,{className:"w-full",children:e.jsx(g,{placeholder:"选择板块"})})}),e.jsxs(f,{className:"w-full",children:[e.jsx(o,{value:"ALL",children:"不限制板块"}),T?.map(a=>e.jsx(o,{value:a.name,children:a.name},a.name))]})]}),e.jsx(O,{})]})}),e.jsx(i,{control:r.control,name:"category",render:({field:s})=>e.jsxs(d,{children:[e.jsx(h,{children:"分类"}),e.jsxs(j,{value:s.value,disabled:!A,onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(p,{className:"w-full",children:e.jsx(g,{placeholder:"选择分类"})})}),e.jsxs(f,{className:"w-full",children:[e.jsx(o,{value:"ALL",children:"不限制类目"}),_?.map(a=>e.jsx(o,{value:a.name,children:a.name},a.name))]})]})]})}),e.jsx(i,{control:r.control,name:"regex",render:({field:s})=>e.jsxs(d,{className:"col-span-full",children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"匹配正则（可选）"]}),e.jsx(m,{children:e.jsx(le,{...s,placeholder:"^[A-Z]{3,5}-\\\\d{3,4}$",className:"font-mono"})})]})}),e.jsx(i,{control:r.control,name:"downloader",render:({field:s})=>e.jsxs(d,{children:[e.jsx(h,{children:"下载器"}),e.jsxs(j,{value:s.value,onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(p,{className:"w-full",children:e.jsx(g,{placeholder:"选择下载器"})})}),e.jsx(f,{className:"w-full",children:D?.map(a=>e.jsx(o,{value:a.id,children:a.id},a.id))})]})]})}),e.jsx(i,{control:r.control,name:"save_path",render:({field:s})=>e.jsxs(d,{children:[e.jsx(h,{children:"存储路径"}),e.jsxs(j,{value:s.value,disabled:!q,onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(p,{className:"w-full",children:e.jsx(g,{placeholder:"选择路径"})})}),e.jsx(f,{className:"w-full",children:K?.map(a=>e.jsx(o,{value:a.path,children:a.path},a.path))})]})]})}),e.jsx(x,{type:"submit",children:"提交"})]})})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(ne,{children:[e.jsx(te,{children:e.jsxs(y,{children:[e.jsx(t,{children:"ID"}),e.jsx(t,{children:"板块"}),e.jsx(t,{children:"分类"}),e.jsx(t,{children:"正则"}),e.jsx(t,{children:"下载器"}),e.jsx(t,{children:"保存路径"}),e.jsx(t,{children:"操作"})]})}),e.jsx(oe,{children:I?e.jsx(y,{children:e.jsx(n,{colSpan:9,className:"text-center",children:"加载中..."})}):R?.length===0?e.jsx(y,{children:e.jsx(n,{colSpan:9,className:"text-center",children:"暂无数据"})}):R?.map(s=>e.jsxs(y,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:s.section}),e.jsx(n,{children:s.category}),e.jsx(n,{children:s.regex}),e.jsx(n,{children:s.downloader}),e.jsx(n,{children:s.save_path}),e.jsxs(n,{children:[e.jsx(x,{variant:"outline",size:"icon",className:"mr-2",onClick:()=>{F(s),u(!0)},children:e.jsx(me,{className:"h-4 w-4"})}),e.jsxs(G,{children:[e.jsx(J,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",className:"text-destructive",children:e.jsx(he,{className:"h-4 w-4"})})}),e.jsxs(U,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"确定要删除吗？"}),e.jsx(ee,{children:"此操作不可恢复，请谨慎操作。"})]}),e.jsxs(se,{children:[e.jsx(ae,{children:"取消"}),e.jsx(re,{onClick:()=>V(s.id),children:"确认删除"})]})]})]})]})]},s.id))})]})})]})}function Ce(){return e.jsx(H,{title:"下载目录路由配置",desc:"管理类目与下载目录的关系,用于自动化操作",icon:e.jsx(ue,{className:"h-5 w-5 text-primary"}),children:e.jsx(we,{})})}const We=Ce;export{We as component};
